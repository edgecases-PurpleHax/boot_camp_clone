## Activity File: Windows Password Spraying

In this activity, you will continue to play the role of a pentester conducting an engagement on MegaCorpOne. Now that you've recognized which machines on MegaCorpOne's network are Windows machines, you will perform your first attack: password spraying. 

In the previous module, you cracked several passwords belonging to the users from the /etc/shadow file on the Linux machine. Now, you'll attempt to use those to log in to a Windows machine. The password spraying technique will utilize the SMB protocol and a Metasploit auxiliary module for SMB logins. Since you will attempt to log in to a domain account, Windows will perform Kerberos authentication.

- You will use Metasploit to perform a password spray attack on the Windows machines that you discovered from your Nmap scans. 

- The goal of this activity is to find a working set of credentials for the target machines that you can use later on to gain access to the machine.

### Instructions

On your Kali machine, open Metasploit and load the `auxiliary/scanner/smb/smb_login` module, as the following image shows:

![A screenshot depicts the loaded modules.](../SMBLogin.PNG)

Referencing your notes, refer back to the usernames and passwords you cracked from the /etc/shadow file on the Linux machine. You will try to use each of these credentials in attempts to find a set that works on a machine. 

1. Set the SMBUser and SMBPass to a set of credentials you cracked from the /etc/shadow file. 

	```
	set SMBUser tstark
	set SMBPass Password!
	```

2. Referencing your nmap/zenmap scans, set SMBDomain to the domain of the Windows10 machine. (If the domain is lab.local, for example, the domain would just be 'lab')

	 - `set SMBDomain megacorpone`

3. Set RHOSTS to the entire subnet in CIDR notation. (E.g., x.x.x.x/24)

     ![A screenshot depicts RHOSTS set to the subnet in CIDR notation.](smboptions.PNG)

4. Run the attack. What machines was it able to successfully log in to?

     - 172.22.117.20
	
	  ![A screenshot depicts successful login.](pass.PNG)

5. Open the WINDC01 VM in Hyper-V and attempt to login with those credentials. Were you able to successfully login?

     - No

6. What was the domain for the account you just password sprayed?

     - megacorpone

---
Â© 2022 Trilogy Education Services, a 2U, Inc. brand. All Rights Reserved.



